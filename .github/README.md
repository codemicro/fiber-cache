# fiber-cache
[![GitHub release (latest by date)](https://img.shields.io/github/v/release/codemicro/fiber-cache)](https://github.com/codemicro/fiber-cache/releases/latest) [![Keep a Changelog v1.0.0 badge](https://img.shields.io/badge/changelog-Keep%20a%20Changelog%20v1.0.0-%23E05735)](https://github.com/codemicro/fiber-cache/blob/master/.github/CHANGELOG.md) [![PkgGoDev](https://pkg.go.dev/badge/codemicro/fiber-cache)](https://pkg.go.dev/github.com/codemicro/fiber-cache) ![Tests](https://github.com/codemicro/fiber-cache/workflows/Run%20tests/badge.svg) ![Gosec audit](https://github.com/codemicro/fiber-cache/workflows/Gosec%20audit/badge.svg)

fiber-cache is middleware that provides caching for specific routes in a Fiber application.

### Examples

The most basic caching you can do is like this:

```go
app.Get("/your/route", fcache.New(), yourHandler)
```

This will then cache the response and status code generated by that endpoint for the default TTL (Time-To-Live) specified. You don't have to do anything different in your handler than you normally would. If you have not changed the default TTL value, it is `5 * time.Minute`.

You can change the default TTL for all endpoints by setting `fcache.Config.DefaultTTL` to a `time.Duration`. This will only have an effect on handlers registered after you change the value.

```go
fcache.Config.DefaultTTL = time.Minute * 2
```

You can also set the TTL for each different handler, for example if you want to set one handler to a 20 second TTL while also maintaining the default TTL at 5 minutes.

```go
app.Get("/your/route", fcache.NewWithTTL(fcache.AutoGenerateKey, time.Second*20), yourHandler)
```

Whenever you have the option to set a TTL, you can also set it to have no expiration. The handler function will be called once and the value stored until your program has exited. This can be done using `fcache.NoExpiration`.

```go
app.Get("/your/route", fcache.NewWithTTL(fcache.AutoGenerateKey, fcache.NoExpiration), yourHandler)
```

Internally, caching is done using key-value pairs. Normally, the keys are automatically generated, but you can choose to set them manually if you want.

```go
app.Get("/your/route", fcache.NewWithKey("yourKeyHere"), yourHandler)
```

The cache key for the current route is stored in `c.Locals` as `cacheKey`. This is especially useful if you're using automatically generated keys and want to access the underlying cache engine. This can be done through the `fcache.Cache` variable. [Please click here for information about that.](https://github.com/patrickmn/go-cache)

```go
app.Get("/your/route", fcache.New(), func(c *fiber.Ctx) error {
    cacheKey := c.Locals("cacheKey").(string) // -> cacheKey-0
    
    data, found := fcache.Cache.Get(cacheKey)

    // ...

    return c.Send("My cache key is: " + cacheKey) // -> My cache key is: cacheKey-0
})
```

### Limitations

fiber-cache will not cache headers. If you want headers to be added to every response on a specific endpoint, you will have to add a custom middleware before the cache middleware.

```go
app.Get("/", func(c *fiber.Ctx) error {
        c.Append("server", "potato")
        return c.Next()
    }, fcache.New(), yourHandler)
```

### Reference

[https://pkg.go.dev/github.com/codemicro/fiber-cache](https://pkg.go.dev/github.com/codemicro/fiber-cache)

### Installation
You must have Go 1.14 or higher installed before attempting installation.

Installation is done using the `go get` command:

```
go get -u github.com/codemicro/fiber-cache/v2
```

You can then import the package as follows:

```go
import (
    fcache "github.com/codemicro/fiber-cache/v2"
)
```

### Benchmarks

Consider the following example:

```go
app.Get("/longtime", fcache.New(), func(c *fiber.Ctx) error {
    time.Sleep(time.Second * 10)
    return c.Send("Hello world")
})
```

When this endpoint is first requested, it takes 10.035 seconds for a response to be returned. After that, across the next 20 requests, it takes an average of 0.01094 seconds for a response to be returned.

### Licence
fiber-cache is free and open source software covered by the Mozilla Public Licence v2.

#### Third party library licences
* [gofiber/fiber](https://github.com/gofiber/fiber/blob/master/LICENSE)
* [patrickmn/go-cache](https://github.com/patrickmn/go-cache/blob/master/LICENSE)

